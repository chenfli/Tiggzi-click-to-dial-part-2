/*
 * JS for Result generated by Exadel Tiggzi
 *
 * Created on: Monday, June 18, 2012, 05:53:34 AM (PDT)
 */
/************************************
 * JS API provided by Exadel Tiggzi  *
 ************************************/
/* Setting project environment indicator */
Tiggr.env = "apk"; /* Object & array with components "name-to-id" mapping */
var n2id_buf = {
    'authCode': 'j_4',
    'accesstoken': 'j_5',
    'mobilegrid1': 'j_6',
    'mobilegridcell1': 'j_7',
    'mobilegridcell2': 'j_8',
    'mobilegrid2': 'j_9',
    'mobilegridcell3': 'j_10',
    'mobilespacer2': 'j_11',
    'mobilegridcell4': 'j_12',
    'mobilelabel3': 'j_13',
    'mobilespacer1': 'j_14',
    'mobileimage1': 'j_15'
};
if ("n2id" in window && window.n2id !== undefined) {
    $.extend(n2id, n2id_buf);
} else {
    window.n2id = n2id_buf;
}
Tiggr.AppPages = [{
    "name": "Result",
    "location": "Result.html"
}, {
    "name": "TEST",
    "location": "TEST.html"
}, {
    "name": "mobilescreen1",
    "location": "mobilescreen1.html"
}, {
    "name": "current",
    "location": "Result.html"
}];
Tiggr.CurrentScreen = 'j_0';

function navigateTo(outcome, useAjax) {
    Tiggr.navigateTo(outcome, useAjax);
}

function adjustContentHeight() {
    Tiggr.adjustContentHeight();
}

function adjustContentHeightWithPadding() {
    Tiggr.adjustContentHeightWithPadding();
}

function unwrapAndApply(selector, content) {
    Tiggr.unwrapAndApply(selector, content);
}

function setDetailContent(pageUrl) {
    Tiggr.setDetailContent(pageUrl);
}
/**********************
 * SECURITY CONTEXTS  *
 **********************/
/*******************************
 *      SERVICE SETTINGS        *
 ********************************/
/*************************
 *      SERVICES          *
 *************************/
/*************************
 * NONVISUAL COMPONENTS  *
 *************************/
var datasources = [];
/************************
 * EVENTS AND HANDLERS  *
 ************************/
// screen onload
screen_2778_onLoad = j_0_onLoad = function() {
    createSpinner("res/lib/jquerymobile/images/ajax-loader.gif");
    Tiggr.__registerComponent('authCode', new Tiggr.BaseComponent({
        id: 'authCode',
        context: '#j_3'
    }));
    Tiggr.__registerComponent('accesstoken', new Tiggr.BaseComponent({
        id: 'accesstoken',
        context: '#j_3'
    }));
    Tiggr.__registerComponent('mobilegrid1', new Tiggr.BaseComponent({
        id: 'mobilegrid1',
        context: '#j_3'
    }));
    Tiggr.__registerComponent('mobilegridcell1', new Tiggr.BaseComponent({
        id: 'mobilegridcell1',
        context: '#j_3'
    }));
    Tiggr.__registerComponent('mobilegridcell2', new Tiggr.BaseComponent({
        id: 'mobilegridcell2',
        context: '#j_3'
    }));
    Tiggr.__registerComponent('mobilegrid2', new Tiggr.BaseComponent({
        id: 'mobilegrid2',
        context: '#j_3'
    }));
    Tiggr.__registerComponent('mobilegridcell3', new Tiggr.BaseComponent({
        id: 'mobilegridcell3',
        context: '#j_3'
    }));
    Tiggr.__registerComponent('mobilespacer2', new Tiggr.BaseComponent({
        id: 'mobilespacer2',
        context: '#j_3'
    }));
    Tiggr.__registerComponent('mobilegridcell4', new Tiggr.BaseComponent({
        id: 'mobilegridcell4',
        context: '#j_3'
    }));
    Tiggr.__registerComponent('mobilelabel3', new Tiggr.BaseComponent({
        id: 'mobilelabel3',
        context: '#j_3'
    }));
    Tiggr.__registerComponent('mobilespacer1', new Tiggr.BaseComponent({
        id: 'mobilespacer1',
        context: '#j_3'
    }));
    Tiggr.__registerComponent('mobileimage1', new Tiggr.BaseComponent({
        id: 'mobileimage1',
        context: '#j_3'
    }));
    for (var idx = 0; idx < datasources.length; idx++) {
        datasources[idx].__setupDisplay();
    }
    screen_2778_elementsExtraJS();
    var vars = [];
    var params = window.top.location.href.slice(window.top.location.href.indexOf('?'));
    params = params.slice(1).split('&');
    console.debug("Got params " + params);
    for (var i in params) {
        var item = params[i].split('=');
        vars.push(item[0]);
        vars[item[0]] = item[1];
    }
    console.debug("Got code " + vars.code);
    localStorage.setItem("auth_token", vars.code);
    console.debug("Got phones " + vars.phones);
    var phones = vars.phones.split('_');
    localStorage.setItem("from", phones[0]);
    localStorage.setItem("to", phones[1]);
    Tiggr('authCode').html(vars.code);
    // 5,6,7 Stage of Foundry Oauth
    sendRequest("https://auth.tfoundry.com/oauth/token?", handleRequest, "grant_type=authorization_code&redirect_uri=http://tiggzi.com/view/3f6ca50e-c260-471f-a6cc-70c890c24f24/mob-Result.html&code=" + vars.code + "&client_id=3ae89f7209498c083997639e220b9a27&client_secret=8e243149cc722191l", null, apiResponse, makeCallXml, addHeaderMakeCall);
    j_0_deviceEvents();
    j_0_windowEvents();
    screen_2778_elementsEvents();
}
// screen window events
screen_2778_windowEvents = j_0_windowEvents = function() {
    $('#j_0').bind('pageshow orientationchange', function() {
        adjustContentHeightWithPadding();
    });
}
// device events
j_0_deviceEvents = function() {
    document.addEventListener("deviceready", function() {});
}
// screen elements extra js
screen_2778_elementsExtraJS = j_0_elementsExtraJS = function() {
    // screen (screen-2778) extra code
}
// screen elements handler
screen_2778_elementsEvents = j_0_elementsEvents = function() {
    $("a :input,a a,a fieldset label").live({
        click: function(event) {
            event.stopPropagation();
        }
    });
}
$("body").undelegate("pagebeforeshow").delegate("#j_0", "pagebeforeshow", function(event, ui) {
    j_0_onLoad();
});